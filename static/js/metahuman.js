(()=>{"use strict";var i={928:(t,e,i)=>{function n(t=""){var e=document.createElement("div");return e.innerHTML=t,e.innerText}function c(t="",e=100){for(var i=[];t&&t.length>e;)i.push(t.substring(0,e)),t=t.slice(e);return t&&i.push(t),i}i.r(e),i.d(e,{dateFormat:()=>function(t,e){var i;var n={"y+":t.getFullYear().toString(),"M+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"h+":t.getHours().toString(),"m+":t.getMinutes().toString(),"s+":t.getSeconds().toString()};for(var o in n)(i=new RegExp("("+o+")").exec(e))&&(e=e.replace(i[1],1==i[1].length?n[o]:n[o].padStart(i[1].length,"0")));return e},guid:()=>function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},htmlToText:()=>n,loadScript:()=>function(t,e){const i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,e())}:i.onload=function(){e()};i.src=t,document.body.append(i)},matchAllWord:()=>function(e,i){let n=!0;for(let t=0;t<i.length;t++)if(!e.includes(i[t])){n=!1;break}return n},splitText:()=>function(t=""){t=(t=(t=n(t)).replace(/\s+/g," ")).replace(/[_]/g,"");let a=100,s=300,r=t.split(/[。！!？?，,；;]/).filter(t=>!!t),l=[];return r.reduce((t,e,i)=>{i=i===r.length-1;if(t){var n=t.concat(" ",e),o=n.length;if(o<a){if(!i)return n;l.push(n)}else{if(o>=a&&o<=s)return l.push(n),"";if(o>s)if(l.push(t),e.length<a){if(!i)return e;l.push(e)}else{if(e.length>=a&&e.length<=s)return l.push(e),"";e.length>s&&l.push(...c(e))}}}else{if(!i)return e;e.length<=s?l.push(e):l.push(...c(e))}return""},""),void 0,void 0,l},splitTextByLimit:()=>c,toAbsURL:()=>function(t){var e=document.createElement("img");return e.src=t,t=e.src,e.src=null,t}})}},n={};function o(t){var e=n[t];return void 0!==e||(e=n[t]={exports:{}},i[t](e,e.exports,o)),e.exports}o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};{var a=o(928);const S=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self;const A=t||e||Function("return this")(),M=function(){return A.Date.now()};var s=/\s/;const b=function(t){for(var e=t.length;e--&&s.test(t.charAt(e)););return e};var r=/^\s+/;const T=function(t){return t&&t.slice(0,b(t)+1).replace(r,"")};var t=A.Symbol,e,l=(e=Object.prototype).hasOwnProperty,c=e.toString,h=t?t.toStringTag:void 0;const w=function(t){var e=l.call(t,h),i=t[h];try{var n=!(t[h]=void 0)}catch(t){}var o=c.call(t);return n&&(e?t[h]=i:delete t[h]),o};var d=Object.prototype.toString;const k=function(t){return d.call(t)};var u=t?t.toStringTag:void 0;const R=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":(u&&u in Object(t)?w:k)(t)},O=function(t){return null!=t&&"object"==typeof t},_=function(t){return"symbol"==typeof t||O(t)&&"[object Symbol]"==R(t)};var g=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,v=/^0o[0-7]+$/i,f=parseInt;const j=function(t){if("number"==typeof t)return t;if(_(t))return NaN;if(S(t)&&(e="function"==typeof t.valueOf?t.valueOf():t,t=S(e)?e+"":e),"string"!=typeof t)return 0===t?t:+t;t=T(t);var e=p.test(t);return e||v.test(t)?f(t.slice(2),e?2:8):g.test(t)?NaN:+t};var y=Math.max,x=Math.min;const B=function(n,i,t){var o,a,s,r,l,c,h=0,d=!1,u=!1,e=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function g(t){var e=o,i=a;return o=a=void 0,h=t,r=n.apply(i,e)}function p(t){var e=t-c;return void 0===c||i<=e||e<0||u&&s<=t-h}function v(){var t,e=M();if(p(e))return f(e);l=setTimeout(v,(t=i-((e=e)-c),u?x(t,s-(e-h)):t))}function f(t){return l=void 0,e&&o?g(t):(o=a=void 0,r)}function m(){var t=M(),e=p(t);if(o=arguments,a=this,c=t,e){if(void 0===l)return h=t=c,l=setTimeout(v,i),d?g(t):r;if(u)return clearTimeout(l),l=setTimeout(v,i),g(c)}return void 0===l&&(l=setTimeout(v,i)),r}return i=j(i)||0,S(t)&&(d=!!t.leading,u="maxWait"in t,s=u?y(j(t.maxWait)||0,i):s,e="trailing"in t?!!t.trailing:e),m.cancel=function(){void 0!==l&&clearTimeout(l),o=c=a=l=void(h=0)},m.flush=function(){return void 0===l?r:f(M())},m},E=function(t,e,i){var n=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return S(i)&&(n="leading"in i?!!i.leading:n,o="trailing"in i?!!i.trailing:o),B(t,e,{leading:n,maxWait:e,trailing:o})};var m=function(t,s,r,l){return new(r=r||Promise)(function(i,e){function n(t){try{a(l.next(t))}catch(t){e(t)}}function o(t){try{a(l.throw(t))}catch(t){e(t)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(n,o)}a((l=l.apply(t,s||[])).next())})};class L{constructor(t){var e;this.isIOS=/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&1<window.navigator.maxTouchPoints,this.model=169,this.modelOffset=[0,0],this.voice="Aixia",this.voiceSpeed=20,this.voiceVolume=50,this.theme="dark",this.speakBeforeLoading=!1,this.speak=E(t=>{this.onSpeakBefore&&this.onSpeakBefore(),t=t&&this._kwReplace(t),AMagics.stopRead();try{AMagics.read(t)}catch(t){}this.speakBeforeLoading&&(this.loading_fecthTTS(),AMagics.playAction("GaoXing_out",!0))},200),this.guid=a.guid(),this.container=t.container,this.model=null!=(e=null==t?void 0:t.model)?e:this.model,this.modelOffset=null!=(e=null==t?void 0:t.modelOffset)?e:this.modelOffset,this.voice=null!=(e=null==t?void 0:t.voice)?e:this.voice,this.voiceSpeed=null!=(e=null==t?void 0:t.voiceSpeed)?e:this.voiceSpeed,this.voiceVolume=null!=(e=null==t?void 0:t.voiceVolume)?e:this.voiceVolume,this.theme=null!=(e=t.theme)?e:this.theme,this.speakKwReplace=null!=(e=null==t?void 0:t.speakKwReplace)?e:this.speakKwReplace,this.speakBeforeLoading=null!=(e=null==t?void 0:t.speakBeforeLoading)?e:this.speakBeforeLoading,this.onReady=t.onReady,this.onSpeakBefore=t.onSpeakBefore,this.onSpeak=t.onSpeak,this.onSpeakEnd=t.onSpeakEnd,this.init()}init(){return m(this,void 0,void 0,function*(){this.htmlInit();try{this.loadSDK(()=>{this.loading(),this.eventListener(),AMagics.on(AMagics.INIT_SUCCESS,()=>{this.modelInit()}),AMagics.on(AMagics.AVATAR_LOADED,t=>{var e;null!=(e=this.humanContainer)&&e.classList.add("mh-human--visible"),this.modelReset(),this.onReady&&this.onReady(),this.loading(!1),setTimeout(()=>{AMagics.playAction("DaZhaoHu_out",!1)},1200)})})}catch(t){this.loading(!1)}})}loadSDK(t){window.AMagics||a.loadScript("https://large.magics-ad.com/AMSDK/release/magicssdk-kpy-1.0.1.1.min.js",t)}eventListener(){AMagics.on(AMagics.READ_BEGIN,()=>{this.speakBeforeLoading&&this.loading_fecthTTS(!1),AMagics.playAction("ZBDH_33Miao_out",!0),this.onSpeak&&this.onSpeak()}),AMagics.on(AMagics.READ_END,()=>{AMagics.stopAction(),this.onSpeakEnd&&this.onSpeakEnd()}),window.addEventListener("resize",()=>{AMagics.setRenderSize(this.container.clientWidth,this.container.clientHeight),this.modelReset()})}htmlInit(){this.container.className+=" mh","light"===this.theme&&(this.container.className+=" mh--light");var[t,e]=this.modelOffset;this.container.innerHTML=`
      <div class="mh-human" style="${`
      left: ${"string"==typeof t?t:t+"px"};
      top: ${"string"==typeof e?e:e+"px"};
    `}">
        <canvas></canvas>
      </div>
      <div class="mh-loading">
        <div class="mh-loading_body">
          <div class="mh-loading_icon mh-anim-loading">
            <i class="mp-icon mp-icon-lixi"></i>
          </div>
          <div class="mh-loading_text">加载中...</div>
        </div>
      </div>
      <div class="mh-loading mh-loading--fecth-tts">
        <div class="mh-loading_body">
          <div class="mh-loading_icon mh-anim-loading">
            <i class="mp-icon mp-icon-lixi"></i>
          </div>
        </div>
      </div>
    `,this.humanContainer=this.container.querySelector(".mh-human"),this.canvas=this.container.querySelector("canvas")}modelInit(){var t;AMagics.initAvatar({canvas:this.canvas,width:null==(t=this.humanContainer)?void 0:t.clientWidth,height:null==(t=this.humanContainer)?void 0:t.clientHeight,avatarId:this.model,voiceName:this.voice,speechRate:this.voiceSpeed,volume:this.voiceVolume})}loading(t=!0){let e=this.container.querySelector(".mh-loading");t?(e.style.zIndex="10",e.style.opacity="1"):(e.style.opacity="0",setTimeout(()=>{e.style.zIndex="-1"},1e3))}loading_fecthTTS(t=!0){let e=this.container.querySelector(".mh-loading--fecth-tts");var i;t?(t=this.container.getBoundingClientRect(),i=AMagics.getBoundingBox(),e.style.top=t.height-i.height+"px",e.style.backgroundColor="transparent",e.style.zIndex="10",e.style.opacity="1"):(e.style.opacity="0",setTimeout(()=>{e.style.zIndex="-1"},1e3))}loadingTextSet(t){this.container.querySelector(".mh-loading_text").innerHTML=t}_kwReplace(i){return this.speakKwReplace&&Object.keys(this.speakKwReplace).forEach(t=>{var e=new RegExp(""+t,"g");i=i.replace(e,this.speakKwReplace[t])}),i}stop(){this.speakBeforeLoading&&this.loading_fecthTTS(!1),AMagics.stopAction(),AMagics.stopRead()}playAction(t,e=!1){AMagics.playAction(t,e)}modelPosToCenter(){var t=AMagics.getBoundingBox(),e=(null==(e=this.canvas)?void 0:e.offsetWidth)/2,i=(null==(i=this.canvas)?void 0:i.offsetHeight)/2-t.height/2+t.height;AMagics.setAvatarPosition(e,i)}modelResize(){var t=AMagics.getBoundingBox(),e=t.width/t.height,i=null!=(i=null==(i=this.humanContainer)?void 0:i.clientWidth)?i:0,n=null!=(n=null==(n=this.humanContainer)?void 0:n.clientHeight)?n:0,o=t.width/t.height;n<i||e<o?AMagics.setAvatarScale(n/t.height*.9):AMagics.setAvatarScale(i/t.width*.9)}modelReset(){this.modelResize(),this.modelPosToCenter()}}L.utils=a,window.Metahuman=L}})();